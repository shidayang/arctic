(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f33bb1f"],{"0482":function(e,t,a){},"06e7":function(e,t,a){"use strict";a.r(t);var n=a("7a23");const o={class:"hive-tables-wrap"},c={key:0,class:"tables-content"},s={class:"g-flex-jsb table-top"},r=["title"],l={class:"right-btn"},i={class:"content"};function d(e,t,a,d,b,u){const p=Object(n["resolveComponent"])("a-button"),g=Object(n["resolveComponent"])("u-details"),m=Object(n["resolveComponent"])("a-tab-pane"),f=Object(n["resolveComponent"])("a-tabs"),j=Object(n["resolveComponent"])("u-loading"),O=Object(n["resolveComponent"])("router-view"),v=Object(n["resolveComponent"])("error-msg");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",o,[e.isSecondaryNav?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",c,[Object(n["createElementVNode"])("div",s,[Object(n["createElementVNode"])("span",{title:e.tableName,class:"table-name g-text-nowrap"},Object(n["toDisplayString"])(e.tableName),9,r),Object(n["createElementVNode"])("div",l,[Object(n["createVNode"])(p,{type:"primary",disabled:e.status===e.upgradeStatus.upgrading,onClick:e.upgradeTable},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.displayStatus),1)]),_:1},8,["disabled","onClick"]),e.status===e.upgradeStatus.failed?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",{key:0,onClick:t[0]||(t[0]=t=>e.showErrorMsg=!0),class:"fail-msg"},Object(n["toDisplayString"])(e.$t("lastUpgradingFailed")),1)):Object(n["createCommentVNode"])("",!0)])]),Object(n["createElementVNode"])("div",i,[Object(n["createVNode"])(f,{activeKey:e.activeKey,"onUpdate:activeKey":t[1]||(t[1]=t=>e.activeKey=t)},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{key:"Details",tab:"Details"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,{partitionColumnList:e.partitionColumnList,schema:e.schema},null,8,["partitionColumnList","schema"])]),_:1})]),_:1},8,["activeKey"])])])),e.loading?(Object(n["openBlock"])(),Object(n["createBlock"])(j,{key:1})):Object(n["createCommentVNode"])("",!0),e.isSecondaryNav?(Object(n["openBlock"])(),Object(n["createBlock"])(O,{key:2,onGoBack:e.goBack,onRefresh:e.refresh},null,8,["onGoBack","onRefresh"])):Object(n["createCommentVNode"])("",!0),e.showErrorMsg?(Object(n["openBlock"])(),Object(n["createBlock"])(v,{key:3,msg:e.errorMessage,onCancle:t[2]||(t[2]=t=>e.showErrorMsg=!1)},null,8,["msg"])):Object(n["createCommentVNode"])("",!0)])}var b=a("47e2");const u={class:"hive-table-detail g-flex"},p={class:"left-content"},g={key:0,class:"table-attrs"},m={class:"attr-title"},f={class:"table-attrs"},j={class:"attr-title"};var O=Object(n["defineComponent"])({__name:"Details",props:{schema:null,partitionColumnList:null},setup(e){const t=e,{t:a}=Object(b["b"])(),o=Object(n["shallowReactive"])([{title:a("field"),dataIndex:"field",width:"30%"},{title:a("type"),dataIndex:"type",width:"30%"},{title:a("description"),dataIndex:"comment",ellipsis:!0}]),c=Object(n["shallowReactive"])([{title:a("field"),dataIndex:"field",width:"30%"},{title:a("type"),dataIndex:"type",width:"30%"},{title:a("description"),dataIndex:"comment",ellipsis:!0}]);return(e,a)=>{const s=Object(n["resolveComponent"])("a-table");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",u,[Object(n["createElementVNode"])("div",p,[t.partitionColumnList&&t.partitionColumnList.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",g,[Object(n["createElementVNode"])("p",m,Object(n["toDisplayString"])(e.$t("partitionKey")),1),Object(n["createVNode"])(s,{rowKey:"field",columns:Object(n["unref"])(c),"data-source":t.partitionColumnList,pagination:!1},null,8,["columns","data-source"])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",f,[Object(n["createElementVNode"])("p",j,Object(n["toDisplayString"])(e.$t("schema")),1),Object(n["createVNode"])(s,{rowKey:"field",columns:Object(n["unref"])(o),"data-source":t.schema,pagination:!1},null,8,["columns","data-source"])])])])}}}),v=(a("73715"),a("6b0d")),k=a.n(v);const y=k()(O,[["__scopeId","data-v-31e13dc2"]]);var h=y;const C={class:"msg"};var $=Object(n["defineComponent"])({__name:"ErrorMsg",props:{msg:null},emits:["cancle"],setup(e,{emit:t}){const a=e;return(e,o)=>{const c=Object(n["resolveComponent"])("a-modal");return Object(n["openBlock"])(),Object(n["createBlock"])(c,{visible:!0,width:560,title:""+e.$t("errorMessage"),footer:null,onCancel:o[0]||(o[0]=e=>t("cancle")),class:"upgrade-error"},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("p",C,Object(n["toDisplayString"])(a.msg),1)]),_:1},8,["title"])}}});a("e900");const w=k()($,[["__scopeId","data-v-a5995806"]]);var N=w,S=a("6c02"),E=a("f38b"),B=a("5738"),V=Object(n["defineComponent"])({name:"Tables",components:{UDetails:h,errorMsg:N},setup(){const e=E["c"],t=Object(n["ref"])(),a=Object(S["e"])(),o=Object(S["d"])(),{t:c}=Object(b["b"])(),s=Object(n["computed"])(()=>!!(o.path.indexOf("upgrade")>-1)),r=Object(n["reactive"])({loading:!1,showErrorMsg:!1,activeKey:"Details",status:"",displayStatus:"",errorMessage:"",tableName:"tableName",partitionColumnList:[],schema:[]}),l=()=>{a.back()},i=Object(n["computed"])(()=>({...o.query})),d=async(e=!1)=>{try{t.value&&clearTimeout(t.value);const{catalog:n,db:s,table:l}=i.value;if(!n||!s||!l)return;!e&&(r.loading=!0);const b=await Object(B["m"])({...i.value}),{status:p,errorMessage:g}=b;r.status=p,r.displayStatus=p===E["c"].upgrading?c("upgrading"):c("upgrade"),r.errorMessage=g||"",p===E["c"].upgrading?t.value=setTimeout(()=>{d(!0)},1500):p===E["c"].none?u():p===E["c"].success?a.replace({path:"/tables",query:{...o.query}}):p===E["c"].failed&&u()}finally{!e&&(r.loading=!1)}},u=async()=>{try{const{catalog:e,db:t,table:a}=i.value;if(!e||!t||!a)return;r.loading=!0;const n=await Object(B["d"])({...i.value}),{partitionColumnList:o=[],schema:c,tableIdentifier:s}=n;r.tableName=(null===s||void 0===s?void 0:s.tableName)||"",r.partitionColumnList=o||[],r.schema=c||[]}catch(e){}finally{r.loading=!1}},p=async()=>{await d()},g=()=>{a.push({path:"/hive-tables/upgrade",query:{...o.query}})},m=()=>{p()};return Object(n["watch"])(()=>o.query,(e,t)=>{const{catalog:a,db:n,table:c}=e;"/hive-tables"!==o.path||a===t.catalog&&n===t.db&&c===t.table||p()}),Object(n["onBeforeUnmount"])(()=>{clearTimeout(t.value)}),Object(n["onMounted"])(()=>{p()}),{...Object(n["toRefs"])(r),isSecondaryNav:s,upgradeStatus:e,upgradeTable:g,goBack:l,refresh:m}}});a("c289");const I=k()(V,[["render",d],["__scopeId","data-v-acbd8ea4"]]);t["default"]=I},5738:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return c})),a.d(t,"j",(function(){return s})),a.d(t,"i",(function(){return r})),a.d(t,"d",(function(){return l})),a.d(t,"m",(function(){return i})),a.d(t,"h",(function(){return d})),a.d(t,"g",(function(){return b})),a.d(t,"k",(function(){return u})),a.d(t,"c",(function(){return p})),a.d(t,"e",(function(){return g})),a.d(t,"f",(function(){return m})),a.d(t,"n",(function(){return f})),a.d(t,"l",(function(){return j}));var n=a("b32d");function o(){return n["a"].get("ams/v1/catalogs")}function c(e){const{catalog:t,keywords:a}=e;return n["a"].get(`ams/v1/catalogs/${t}/databases`,{params:{keywords:a}})}function s(e){const{catalog:t,db:a,keywords:o}=e;return n["a"].get(`ams/v1/catalogs/${t}/databases/${a}/tables`,{params:{keywords:o}})}function r({catalog:e="",db:t="",table:a="",token:o=""}){return n["a"].get(`ams/v1/tables/catalogs/${e}/dbs/${t}/tables/${a}/details`,{params:{token:o}})}function l({catalog:e="",db:t="",table:a=""}){return n["a"].get(`ams/v1/tables/catalogs/${e}/dbs/${t}/tables/${a}/hive/details`)}function i({catalog:e="",db:t="",table:a=""}){return n["a"].get(`ams/v1/tables/catalogs/${e}/dbs/${t}/tables/${a}/upgrade/status`)}function d(e){const{catalog:t,db:a,table:o,page:c,pageSize:s,token:r}=e;return n["a"].get(`ams/v1/tables/catalogs/${t}/dbs/${a}/tables/${o}/partitions`,{params:{page:c,pageSize:s,token:r}})}function b(e){const{catalog:t,db:a,table:o,partition:c,page:s,pageSize:r,token:l}=e;return n["a"].get(`ams/v1/tables/catalogs/${t}/dbs/${a}/tables/${o}/partitions/${c}/files`,{params:{page:s,pageSize:r,token:l}})}function u(e){const{catalog:t,db:a,table:o,page:c,pageSize:s,token:r}=e;return n["a"].get(`ams/v1/tables/catalogs/${t}/dbs/${a}/tables/${o}/transactions`,{params:{page:c,pageSize:s,token:r}})}function p(e){const{catalog:t,db:a,table:o,transactionId:c,page:s,pageSize:r,token:l}=e;return n["a"].get(`ams/v1/tables/catalogs/${t}/dbs/${a}/tables/${o}/transactions/${c}/detail`,{params:{page:s,pageSize:r,token:l}})}function g(e){const{catalog:t,db:a,table:o,page:c,pageSize:s,token:r}=e;return n["a"].get(`ams/v1/tables/catalogs/${t}/dbs/${a}/tables/${o}/operations`,{params:{page:c,pageSize:s,token:r}})}function m(e){const{catalog:t,db:a,table:o,page:c,pageSize:s,token:r}=e;return n["a"].get(`ams/v1/tables/catalogs/${t}/dbs/${a}/tables/${o}/optimizing-processes`,{params:{page:c,pageSize:s,token:r}})}function f({catalog:e="",db:t="",table:a="",properties:o={},pkList:c=[]}){return n["a"].post(`ams/v1/tables/catalogs/${e}/dbs/${t}/tables/${a}/upgrade`,{properties:o,pkList:c})}function j(){return n["a"].get("ams/v1/upgrade/properties")}},73715:function(e,t,a){"use strict";a("0482")},9017:function(e,t,a){},a65b:function(e,t,a){},c289:function(e,t,a){"use strict";a("a65b")},e900:function(e,t,a){"use strict";a("9017")},f38b:function(e,t,a){"use strict";var n,o,c;a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return o})),a.d(t,"b",(function(){return c})),function(e){e["Created"]="#f5f5f5",e["Failed"]="#fff2f0",e["Finished"]="#f6ffed",e["Canceled"]="#f5f5f5"}(n||(n={})),function(e){e["failed"]="FAILED",e["upgrading"]="UPGRADING",e["success"]="SUCCESS",e["none"]="NONE"}(o||(o={})),function(e){e["ICEBERG"]="iceberg",e["ARCTIC"]="amoro",e["HIVE"]="hive"}(c||(c={}))}}]);